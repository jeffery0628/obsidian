---
Create: 2021年 十二月 13日, 星期一 22:49
tags: 
  - Engineering/redis
  - 大数据
---


## RDB是什么

在指定的时间间隔内将内存中的数据集快照写入磁盘，也就是行话讲的Snapshot快照，它恢复时是将快照文件直接读到内存里。

Redis会单独创建（fork）一个子进程来进行持久化，会先将数据写入到一个临时文件中，待持久化过程都结束了，再用这个临时文件替换上次持久化好的文件。整个过程中，主进程是不进行任何IO操作的，这就确保了极高的性能如果需要进行大规模数据的恢复，且对于数据恢复的完整性不是非常敏感，那RDB方式要比AOF方式更加的高效。RDB的缺点是最后一次持久化后的数据可能丢失。

> fork的作用是复制一个与当前进程一样的进程。新进程的所有数据（变量、环境变量、程序计数器等）
数值都和原进程一致，但是是一个全新的进程，并作为原进程的子进程

rdb 保存的是dump.rdb文件。


## 配置位置
redis.conf 文件中==SNAPSHOTTING==下


## RDB快照触发条件

冷拷贝后仍然可以正常使用：cp dump.rdb dump_new.rdb
> 冷备份(cold backup)，也被称为离线备份，是指在关闭数据库,并且数据库不能更新的状况下进行的数据库完整备份。并可对数据进行指定恢复


save: SAVE命令执行一个同步保存操作，将当前 Redis 实例的所有数据快照(snapshot)以 RDB 文件的形式保存到硬盘。
bgsave: Redis会在后台异步进行快照操作，快照同时还可以响应客户端请求。可以通过lastsave命令获取最后一次成功执行快照的时间
flushall: 执行flushall命令，也会产生dump.rdb文件，但里面是空的，无意义


## 使用RDB文件恢复redis
1. 将备份文件 (dump.rdb) 移动到 redis 安装目录并启动服务即可
2. config get rdb文件目录


## 优点
1. 适合大规模的数据恢复
2. 对数据完整性和一致性要求不高

## 缺点
1. 在一定间隔时间做一次备份，所以如果redis意外down掉的话，就会丢失最后一次快照后的所有修改
2. fork的时候，内存中的数据被克隆了一份，大致2倍的膨胀性需要考虑

