---
Create: 2022年 一月 19日, 星期三 09:58
tags: 
  - Engineering/hadoop
  - 大数据
---

## MR支持的压缩编码

| 压缩格式 | hadoop自带？ | 算法    | 文件扩展名 | 是否可切分 | 换成压缩格式后，原来的程序是否需要修改 |
| -------- | ------------ | ------- | ---------- | ---------- | -------------------------------------- |
| DEFLATE  | 是，直接使用 | DEFLATE | .deflate   | 否         | 和文本处理一样，不需要修改             |
| Gzip     | 是，直接使用 | DEFLATE | .gz        | 否         | 和文本处理一样，不需要修改             |
| bzip2    | 是，直接使用 | bzip2   | .bz2       | 是         | 和文本处理一样，不需要修改             |
| LZO      | 否，需要安装 | LZO     | .lzo       | 是         | 需要建索引，还需要指定输入格式         |
| Snappy   | 否，需要安装 | Snappy  | .snappy    | 否         | 和文本处理一样，不需要修改  ÷          |

为了支持多种压缩/解压缩算法，Hadoop引入了编码/解码器，如下表所示。

| 压缩格式 | 对应的编码/解码器                          |
| -------- | ------------------------------------------ |
| DEFLATE  | org.apache.hadoop.io.compress.DefaultCodec |
| gzip     | org.apache.hadoop.io.compress.GzipCodec    |
| bzip2    | org.apache.hadoop.io.compress.BZip2Codec   |
| LZO      | com.hadoop.compression.lzo.LzopCodec       |
| Snappy   | org.apache.hadoop.io.compress.SnappyCodec  |

压缩性能的比较：

| 压缩算法 | 原始文件大小 | 压缩文件大小 | 压缩速度 | 解压速度 |
| -------- | ------------ | ------------ | -------- | -------- |
| gzip     | 8.3GB        | 1.8GB        | 17.5MB/s | 58MB/s   |
| bzip2    | 8.3GB        | 1.1GB        | 2.4MB/s  | 9.5MB/s  |
| LZO      | 8.3GB        | 2.9GB        | 49.3MB/s | 74.6MB/s |



## 压缩方式选择
### Gzip压缩
==优点==：
1. 压缩率比较高，而且压缩/解压速度也比较快；
2. Hadoop本身支持，在应用中处理Gzip格式的文件就和直接处理文本一样;
3. 大部分Linux系统都自带Gzip命令，使用方便。

==缺点==：不支持split。

==应用场景==：当每个文件压缩之后在130M以内的(一个块大小内)，都可以考虑用Gzip压缩格式。例如，一天或者一个小时的日志压缩成一个Gzip文件。


### Bzip2压缩
==优点==：
1. 支持Split；
2. 具有很高的压缩率，比Gzip压缩率都高；
3. Hadoop本身自带，使用方便。

==缺点==：压缩/解压速度慢。

==应用场景==：适合对速度要求不高，但需要较高的压缩率的时候；或者输出之后的数据比较大，处理之后的数据需要压缩存档减少磁盘空间并且以后数据用得比较少的情况；或者对单个很大的文本文件想压缩减少存储空间，同时有需要支持split，而且兼容之前的应用程序的情况。


### Lzo 压缩
==优点==：
1. 压缩/解压速度也比较快，合理的压缩率；
2. 支持split，是Hadoop中最流行的压缩格式；
3. 可以在linux系统下安装lzop命令，使用方便

==缺点==：
1. 压缩率比Gzip要低一些；
2. Hadoop本身不支持，需要安装；
3. 在应用中对Lzo格式的文件要做一些特殊处理(为了支持split需要建索引,还需要指定InputFormat为Lzo格式)。

==应用场景==：
一个很大的文本文件，压缩之后还大于200M以上可以考虑，而且单个文件越大，Lzo优点越明显。

### Snappy 压缩
==优点==：高速压缩速度和合理的压缩率。
==缺点==：
1. 不支持split；
2. 压缩率比Gzip要低；
3. Hadoop本身不支持，需要安装。

==应用场景==：当MapReduce作业的M安排输出的数据比较大的时候，作为Map到Reduce的中间数据的压缩格式；或者作为一个MapReduce作业的输出和另一个MapReduce作业的输入。

